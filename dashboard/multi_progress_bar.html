<div class="cmd cmd-widget #history#" data-type="info" data-subtype="numeric" data-cmd_id="#id#" data-cmd_uid="#uid#" data-version="#version#" data-eqLogic_id="#eqLogic_id#">
  <div class="content-lg">
    <!-- Progress bar en cercle-->
    <div class="progress cercle val_deux">
      <span class="progress-left cercle-left">
        <span class="progress-bar cercle-bar"></span>
      </span>
      <span class="cercle-right">
        <span class="cercle-bar"></span>
      </span>
      <div class="cercle-value">#state# #unite#</div>
    </div>
    <!--Fin progress bar en cercle -->
  </div>

  <div class="content-sm">
    <!--Progress bar horizontal -->
    <div class="progress horizontale">
      <div class="progress-bar horizontal_bar" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100">
        #state# #unite#
      </div>
    </div>
    <!--Fin progress bar horizontale -->
  </div>

  <div class="content-xs">
    <!--Progress bar vertical -->
    <div class="progress vertical">
      <div class="progress-bar vertical_bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100">
        <div class="vertical_value">#state# #unite#</div>
      </div>
    </div>
    <!--Fin progress bar vertical -->
  </div>
</div>

<style>
  :root {
    --rouge: #f63a0f;
    --orange: #f27011;
    --jaune: #f2b01e;
    --jaune_clair: #f2d31b;
    --vert: #86e01e;
    --noir: #000000;
    --blanc: #ffffff;
    --degresd: 0deg;
    --degresg: 0deg;
    --couleuractualisee#id#: var(--noir);
    /* Dans le CSS il existe 2 demi cercle, le premier sur la partie droite va de 0 a 180°
          Le second sur la partie gauche vas de 180 a 360
          Pour le calcul il faudra faire pourcentage * 3,6 - 180 si supérieur a 50%

        calcul de degres : pourcentage * 3,6 */
  }

  .cercle {
    width: 100px;
    height: 100px;
    line-height: 100px;
    background: none;
    margin: 0 auto;
    box-shadow: none;
    position: relative;
  }

  .cercle:after {
    content: "";
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 12px solid #fff;
    position: absolute;
    top: 0;
    left: 0;
  }

  .cercle>span {
    width: 50%;
    height: 100%;
    overflow: hidden;
    position: absolute;
    top: 0;
    z-index: 1;
  }

  .cercle .cercle-left {
    left: 0;
  }

  .cercle .cercle-bar {
    width: 100%;
    height: 100%;
    background: none;
    border-width: 12px;
    border-style: solid;
    position: absolute;
    top: 0;
  }

  .cercle .cercle-left .cercle-bar {
    left: 100%;
    border-top-right-radius: 80px;
    border-bottom-right-radius: 80px;
    border-left: 0;
    -webkit-transform-origin: center left;
    transform-origin: center left;
  }

  .cercle .cercle-right {
    right: 0;
  }

  .cercle .cercle-right .cercle-bar {
    left: -100%;
    border-top-left-radius: 80px;
    border-bottom-left-radius: 80px;
    border-right: 0;
    -webkit-transform-origin: center right;
    transform-origin: center right;
    animation: loading-1 1.8s linear forwards;
  }

  .cercle .cercle-value {
    width: 90%;
    height: 90%;
    border-radius: 50%;
    background: #44484b;
    font-size: 24px;
    color: #fff;
    line-height: 90px;
    text-align: center;
    position: absolute;
    top: 5%;
    left: 5%;
  }

  .cercle.val_deux .cercle-bar {
    border-color: var(--couleuractualisee#id#);
  }

  .cercle.val_deux .cercle-left .cercle-bar {
    animation: loading-2 1.5s linear forwards 1.8s;
  }

  @keyframes loading-1 {
    0% {
      -webkit-transform: rotate(0deg);
      transform: rotate(0deg);
    }

    100% {
      -webkit-transform: rotate(var(--degresd));
      transform: rotate(var(--degresd));
    }
  }

  @keyframes loading-2 {
    0% {
      -webkit-transform: rotate(0deg);
      transform: rotate(0deg);
    }

    100% {
      -webkit-transform: rotate(var(--degresg));
      transform: rotate(var(--degresg));
    }
  }

  @media only screen and (max-width: 990px) {
    .progress {
      margin-bottom: 20px;
    }
  }

  .horizontale {
    border-radius: 4px;
    width: 100px;

    margin: 0 auto;
    /* a supprimer si problème d'affichage */
  }

  .horizontale .horizontal_bar {
    min-width: 2em;
    background-color: var(--couleuractualisee#id#) !important;
    width: 33%;
  }

  .vertical {
    width: 36px;
    min-height: 85px;
    margin-right: 20px;
    border-radius: 6px !important;
    transform: rotate(180deg);
    margin: 0 auto;
    /* a supprimer si problème d'affichage */

  }

  .vertical_bar {
    min-height: 2em;
    width: 100%;
    height: 0;
    -webkit-transition: height 0.6s ease;
    -o-transition: height 0.6s ease;
    transition: height 0.6s ease;
    display: flex;
    background-color: var(--couleuractualisee#id#) !important;
    height: #value#%;
    /*hauteur a modifieir via javascript*/
  }

  .vertical_value {
    margin: auto;
    transform: rotate(180deg);
  }
</style>

<script>
  jeedom.cmd.update['#id#'] = function(_options) {
    var cmd = $('.cmd[data-cmd_id=#id#]');

    var valeur = _options.display_value;
    var inverser = ('#inverser#' == '') ? 1 : parseInt('#inverser#');
    var type = ('#type#' == '') ? 'cercle' : '#type#';
    var unite = ('#unite#' == '') ? 'numerique' : '#unite#';
    var maximum = ('#maxValue#' == '') ? 100 : parseInt('#maxValue#');
    var minimum = ('#minValue#' == '') ? 0 : parseInt('#minValue#');
    var err = 0;

    if (unite == 'numerique') {
      valeur = ((valeur * 100) / maximum);
    } else if (unite == "%" && (valeur < 0 || valeur > 100)) {
      valeur = 0;
      cmd.find('.cercle-value').empty().append('Err');
      cmd.find('.horizontal_bar').empty().append('Err');
      cmd.find('.vertical_value').empty().append('Err');

      err = 1;
    }

    if (type == 'cercle' && err == 0) {
      cmd.find('.content-sm').hide();
      cmd.find('.content-xs').hide();

      if (unite == "numerique" || unite == "%") {
        if (valeur >= minimum && valeur <= maximum) {
          if (valeur > 50) {
            document.documentElement.style.setProperty('--degresd', '180deg');
            document.documentElement.style.setProperty('--degresg', ((valeur - 50) * 3.6) + 'deg');
          } else {
            document.documentElement.style.setProperty('--degresd', (valeur * 3.6) + 'deg');
            document.documentElement.style.setProperty('--degresg', '0deg');
          }
        }
      }
      cmd.find('.cercle-value').empty().append(valeur + ' #unite#');

    } else if (type == "horizontal" && err == 0) {
      cmd.find('.content-lg').hide();
      cmd.find('.content-xs').hide();
      if (valeur >= minimum && valeur <= maximum) {
        cmd.find('.horizontal_bar').attr('style', 'width: ' + valeur + '%;');
      }
      cmd.find('.horizontal_bar').empty().append(valeur + ' #unite#');

    } else if (type == "vertical" && err == 0) {
      cmd.find('.content-lg').hide();
      cmd.find('.content-sm').hide();
      if (valeur >= minimum && valeur <= maximum) {
        cmd.find('.vertical_bar').attr('style', 'height: ' + valeur + '%;');
      }
      cmd.find('.vertical_value').empty().append(valeur + ' #unite#');
    }

    if(valeur>=((maximum/5)*0) && valeur <(maximum/5)) {
      inverser ? document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--vert') : document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--rouge');
    }else if(valeur>=(maximum/5) && valeur <((maximum/5)*2)) {
      inverser ? document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--jaune_clair') : document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--orange');
    }else if(valeur>=((maximum/5)*2) && valeur <((maximum/5)*3)) {
      inverser ? document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--jaune') : document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--jaune');
    }else if(valeur>=((maximum/5)*3) && valeur <((maximum/5)*4)) {
      inverser ? document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--orange') : document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--jaune_clair');
    }else if(valeur>=((maximum/5)*4) && valeur <= maximum) {
      inverser ? document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--rouge') : document.documentElement.style.setProperty('--couleuractualisee#id#', 'var(--vert');
    }



    $('.cmd[data-cmd_id=#id#]').attr('title', 'Valeur du ' + _options.valueDate + ', collectée le ' + _options.collectDate);
  }
  jeedom.cmd.update['#id#']({
    display_value: '#state#',
    valueDate: '#valueDate#',
    collectDate: '#collectDate#',
    alertLevel: '#alertLevel#'
  });
</script>
